@model VolleyballRallyManager.App.Areas.Admin.Models.MatchScorerViewModel

@{
    ViewData["Title"] = "Match Scorer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/scorer.css" />

<div class="scorer-container">
    <div class="row mb-2">
        <div class="col">
            <h3>Match #@Model.MatchNumber Scorer</h3>
        </div>
        <div class="col-auto">
            <a asp-action="Details" asp-route-id="@Model.MatchId" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Details
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Main Scoring Area -->
        <div class="col-lg-9">
            <!-- Team Score Panels -->
            <div class="row mb-4">
                <div class="col-md-5">
                    <div class="team-panel" id="homeTeamPanel">
                        <div class="team-name" id="homeTeamName">
                            @Model.HomeTeamName
                            <i class="bi bi-trophy-fill blink-fade" style="display:none"></i>
                        </div>
                        <div class="team-score" id="homeScore">0</div>
                        <div>
                            <button class="btn btn-light score-btn" data-team-id="@Model.HomeTeamId" data-opcode="updateScore" data-score-change="1">+</button>
                            <button class="btn btn-outline-light score-btn" data-team-id="@Model.HomeTeamId" data-opcode="updateScore" data-score-change="-1">−</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-2 d-flex flex-column align-items-center justify-content-center">
                    <p class="text-muted">@Model.CourtLocation</p>
                    <br />
                    <h1 class="text-muted">VS</h1>
                    <br />
                    <div class="set-label text-center" id="setLabel">SET 1</div>
                    <!-- Sets Won Display -->
                    <div class="sets-won-display">
                        <div>
                            <div id="homeSetsWon">0</div>
                            <small>@Model.HomeTeamName</small>
                        </div>
                        <div class="text-muted fs-3">|</div>
                        <div>
                            <div id="awaySetsWon">0</div>
                            <small>@Model.AwayTeamName</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="team-panel away-panel" id="awayTeamPanel">
                        <div class="team-name" id="awayTeamName">
                            @Model.AwayTeamName
                            <i class="bi bi-trophy-fill blink-fade" style="display:none"></i>
                        </div>
                        <div class="team-score" id="awayScore">0</div>
                        <div>
                            <button class="btn btn-light score-btn" data-team-id="@Model.AwayTeamId" data-opcode="updateScore" data-score-change="1">+</button>
                            <button class="btn btn-outline-light score-btn" data-team-id="@Model.AwayTeamId" data-opcode="updateScore" data-score-change="-1">−</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Controls -->
            <div class="center-controls">
                
                <div id="setBtnDisplayArea" class="row mb-3">
                    <div class="col-md-4">
                        <button class="btn btn-warning set-control-btn" id="btnPreviousSet" data-opcode="handleSetAction" data-action="RevertToPreviousSet" disabled>
                            <i class="bi bi-arrow-left"></i> Previous Set
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-danger set-control-btn" id="btnEndSet" data-opcode="handleSetAction" data-action="EndCurrentSet">
                            <i class="bi bi-stop-circle"></i> End Set
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-success set-control-btn" id="btnNewSet" data-opcode="handleSetAction" data-action="StartNextSet" style="display:none;">
                            <i class="bi bi-plus-circle"></i> New Set
                        </button>
                    </div>
                </div>


                <!-- Set History -->
                <div class="set-history">
                    <h6>Set History</h6>
                    <div id="setHistoryList">
                        <p class="text-muted">No sets completed yet</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h5 class="text-white mb-3">Quick Actions</h5>
                <div class="row">
                    <div class="col-md-3">
                        <button class="btn btn-info quick-action-btn"  data-opcode="handleQuickAction" data-action="CallToCourt">
                            <i class="bi bi-megaphone"></i> Call to Court
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-success quick-action-btn" id="btnStartMatch" data-opcode="handleQuickAction" data-action="MatchStarted">
                            <i class="bi bi-play-circle"></i> Match Started
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-danger quick-action-btn" id="btnEndMatch" data-opcode="handleQuickAction" data-action="MatchEnded">
                            <i class="bi bi-stop-circle"></i> Match Ended
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-warning quick-action-btn" data-opcode="handleQuickAction" data-action="Disputed">
                            <i class="bi bi-exclamation-triangle"></i> Disputed
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Feed Sidebar -->
        <div class="col-lg-3">
            <div class="update-feed">
                <h5 class="mb-3">
                    <i class="bi bi-chat-dots"></i> Live Updates
                </h5>
                <div id="updateFeed">
                    <p class="text-muted">No updates yet</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>
    <script src="~/js/scorer.js" 
            asp-append-version="true"
            data-match-id="@Model.MatchId" 
            data-hometeam-id="@Model.HomeTeamId" 
            data-awayteam-id="@Model.AwayTeamId"
            data-current-set-number="@Model.CurrentSetNumber"
            data-sets='@Html.Raw(Json.Serialize(Model.Sets))'
            data-is-finished="@Model.IsFinished.ToString().ToLower()"></script>
}
