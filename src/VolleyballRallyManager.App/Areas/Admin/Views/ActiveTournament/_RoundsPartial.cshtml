@model List<VolleyballRallyManager.Lib.Models.TournamentRoundViewModel>
@{
    var totalScheduled = Model.Sum(r => r.MatchesScheduled);
    var totalPlayed = Model.Sum(r => r.MatchesPlayed);
    var overallPercentage = totalScheduled > 0 ? (int)((double)totalPlayed / totalScheduled * 100) : 0;
}
<div class="mb-3">
    <h6>Overall Progress</h6>
    <div class="progress" style="height: 25px;">
        <div class="progress-bar bg-success" role="progressbar"
             style="width: @overallPercentage%;"
             aria-valuenow="@overallPercentage"
             aria-valuemin="0"
             aria-valuemax="100">
            @totalPlayed / @totalScheduled matches (@overallPercentage%)
        </div>
    </div>
</div>
<small class="text-muted">
    <strong>@Model.Count</strong> rounds across
    <strong>@Model.Select(r => r.DivisionId).Distinct().Count()</strong> divisions
</small>
@{
    var roundsByDivision = Model.GroupBy(r => r.DivisionName);
}
@foreach (var divisionGroup in roundsByDivision)
{
    <h5 class="mt-3">@divisionGroup.Key</h5>
    <div class="table-responsive mb-4">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Round Name</th>
                    <th>Teams</th>
                    <th>Matches Scheduled</th>
                    <th>Matches Completed</th>
                    <th>Progress</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var round in divisionGroup.OrderBy(r => r.RoundNumber))
                {
                    <tr class="clickable-row" style="cursor: pointer;" onclick="window.location.href='@Url.Action("Details", "TournamentRounds", new { id = round.TournamentRoundId })'">
                        <td><strong>@round.RoundName</strong></td>
                        <td>@round.TeamCount</td>
                        <td>@round.MatchesScheduled</td>
                        <td>@round.MatchesPlayed</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-success" role="progressbar"
                                     style="width: @round.CompletionPercentage%;"
                                     aria-valuenow="@round.CompletionPercentage"
                                     aria-valuemin="0"
                                     aria-valuemax="100">
                                    @round.CompletionPercentage%
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
